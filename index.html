<!DOCTYPE html>
<html>

<head>
    <title>Afterwork location service</title>
    <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
    <div class="container">
        <div class="button" id="button" onClick=geo()>
            Olen afterworkilla
        </div>
        <div class="loader" id="loader"></div>
        <div class="list" id="list">
            <div class="row">

                <input list="venues" />
                <datalist id="venues" />
            
            </div>

            <div class="row"> 
           
                <div class="button" onClick=search()>
                    Hae
                </div>

                <div class="button" onClick=save()>
                    Rekistöröi
                </div>
                
            </div>
        </div>
        
    </div>
    
    <script>
        function geo() {
            if ("geolocation" in navigator) {
                
                document.getElementById("button").setAttribute("style", "display:none");
                document.getElementById("loader").setAttribute("style", "display:inline-block");

                navigator.geolocation.getCurrentPosition(function (location) {
                    console.log("Get Venues");
                    getVenues(location.coords);
                });

            } else {

                console.log("Can't locate you!");

            }
        }

        function getVenues(coords) {
            fetch('https://ym8nrjkifa.execute-api.eu-west-1.amazonaws.com/prod/venues?ll=61.496417,23.768726')
                .then(
                function (response) {
                    if (response.status !== 200) {
                        console.log('Looks like there was a problem. Status Code: ' +
                            response.status);
                        return;
                    }

                    response.json().then(function (data) {
                        showPossibilities(data);
                    });
                })
                .catch(function (err) {
                    console.log('Fetch error: ', err);
                })
        }

        function showPossibilities(venues) {
            venues.map((venue) => {
                let node = document.createElement("OPTION");
                node.setAttribute("value", venue.name);
                document.getElementById("venues").appendChild(node);
            });
            console.log(venues)
            document.getElementById("loader").setAttribute("style", "display:none");
            document.getElementById("list").setAttribute("style", "display:inline-block");
        }

    </script>
</body>

</html>